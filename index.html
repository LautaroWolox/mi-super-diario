<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroDiary 4.0</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="login-screen" class="screen">
        <div class="glass-panel login-box">
            <i class="fa-solid fa-brain logo-icon"></i>
            <h1>NeuroDiary</h1>
            <p style="color: #94a3b8;">Tu sistema operativo mental.</p>
            <button id="btn-login" class="google-btn">
                <i class="fa-brands fa-google"></i> Continuar con Google
            </button>
        </div>
    </div>

    <div id="app-screen" class="screen hidden">
        <nav class="sidebar glass-panel">
            <i class="fa-solid fa-fingerprint logo-icon" style="font-size: 1.5rem; margin-top: 10px;"></i>
            <button onclick="showCalendarView()" class="nav-btn active" title="Mi Espacio"><i class="fa-solid fa-layer-group"></i></button>
            <button onclick="showChatView()" class="nav-btn" title="Asistente"><i class="fa-solid fa-microchip"></i></button>
            <div style="flex:1"></div>
            <button id="btn-logout" class="nav-btn" style="color:#ef4444"><i class="fa-solid fa-power-off"></i></button>
        </nav>

        <main class="content">
            
            <div id="main-view" class="dashboard-grid">
                
                <div class="glass-panel calendar-card">
                    <div class="cal-header">
                        <button class="cal-nav" onclick="changeMonth(-1)"><i class="fa-solid fa-chevron-left"></i></button>
                        <h2 id="month-display">Mes Año</h2>
                        <button class="cal-nav" onclick="changeMonth(1)"><i class="fa-solid fa-chevron-right"></i></button>
                    </div>
                    <div class="weekdays">
                        <div>D</div><div>L</div><div>M</div><div>M</div><div>J</div><div>V</div><div>S</div>
                    </div>
                    <div id="calendar-grid" class="days-grid"></div>
                </div>

                <div class="glass-panel detail-card">
                    <h2 id="selected-date-title" class="date-title">Selecciona un día</h2>
                    
                    <div class="tasks-area">
                        <div class="task-header">
                            <h4 style="margin:0; color:var(--text-muted);"><i class="fa-solid fa-list-check"></i> Rutina & Tareas</h4>
                        </div>
                        <div class="task-input-group">
                            <input type="text" id="new-task-input" class="task-input" placeholder="+ Agregar tarea...">
                            <button class="add-btn" onclick="addTask()"><i class="fa-solid fa-plus"></i></button>
                        </div>
                        <div id="task-list" class="task-list">
                            </div>
                    </div>

                    <div class="journal-area">
                        <h4 style="margin:0; color:var(--text-muted);"><i class="fa-solid fa-pen-nib"></i> Diario & Notas</h4>
                        <textarea id="diary-input" placeholder="¿Qué tal estuvo tu día? ¿Cómo te sientes?"></textarea>
                    </div>

                    <input type="file" id="img-upload" accept="image/*" style="display:none" onchange="handleImageUpload()">

                    <div class="actions">
                        <button class="btn-main ai-btn" onclick="document.getElementById('img-upload').click()" title="Subir Foto">
                            <i class="fa-solid fa-camera"></i>
                        </button>
                        <button class="btn-main ai-btn" onclick="analyzeEmotion()">
                            <i class="fa-solid fa-wand-magic-sparkles"></i> Analizar
                        </button>
                        <button class="btn-main save-btn" onclick="saveData()">
                            <i class="fa-solid fa-floppy-disk"></i> Guardar Todo
                        </button>
                    </div>

                    <div id="ai-feedback" class="ai-popup"></div>
                </div>
            </div>

            <div id="chat-view" class="hidden glass-panel" style="height:100%; padding:30px; border-radius:24px; display:flex; flex-direction:column;">
                <h2>Asistente Gemini</h2>
                <div id="chat-history" style="flex:1; overflow-y:auto; margin-bottom:20px;"></div>
                <div style="display:flex; gap:10px;">
                    <input id="gemini-prompt" type="text" style="flex:1; background:rgba(0,0,0,0.3); border:1px solid var(--glass-border); padding:15px; border-radius:50px; color:white;" placeholder="Habla con tu diario...">
                    <button onclick="askGemini()" style="width:50px; height:50px; border-radius:50%; background:var(--primary); border:none; color:white; cursor:pointer;"><i class="fa-solid fa-paper-plane"></i></button>
                </div>
            </div>

        </main>
    </div>

    <script src="auth.js"></script>
    <script src="app.js"></script>
    <script src="gemini.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer onload="gisLoaded()"></script>
    <script src="https://apis.google.com/js/api.js" async defer onload="gapiLoaded()"></script>
</body>
</html>